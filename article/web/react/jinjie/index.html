<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <link rel="icon" href="/images/logo.png"><title>gear</title><meta name="description" content="道阻且长，行则将至">
    <link rel="preload" href="/assets/style-BgfpeiQa.css" as="style"><link rel="stylesheet" href="/assets/style-BgfpeiQa.css">
    <link rel="modulepreload" href="/assets/app-BzeNYtxQ.js"><link rel="modulepreload" href="/assets/index.html-CDUKEqI3.js">
    <link rel="prefetch" href="/assets/get-started.html-BQXuzPJm.js" as="script"><link rel="prefetch" href="/assets/index.html-BNOkbKc0.js" as="script"><link rel="prefetch" href="/assets/archive1.html-DuCA81gE.js" as="script"><link rel="prefetch" href="/assets/archive2.html-Co5CxJZ0.js" as="script"><link rel="prefetch" href="/assets/article1.html-qODhYYSA.js" as="script"><link rel="prefetch" href="/assets/article10.html-BCh4cZLs.js" as="script"><link rel="prefetch" href="/assets/article11.html-CqWXXV6h.js" as="script"><link rel="prefetch" href="/assets/article12.html-BehLyYLz.js" as="script"><link rel="prefetch" href="/assets/article2.html-W-JhZmqw.js" as="script"><link rel="prefetch" href="/assets/article3.html-D-PDwS3s.js" as="script"><link rel="prefetch" href="/assets/article4.html-0GIC0Uow.js" as="script"><link rel="prefetch" href="/assets/article5.html-BDwz2Dh5.js" as="script"><link rel="prefetch" href="/assets/article6.html-DpkTDmj8.js" as="script"><link rel="prefetch" href="/assets/article7.html-BUXA91Pp.js" as="script"><link rel="prefetch" href="/assets/article8.html-trUqvkKn.js" as="script"><link rel="prefetch" href="/assets/article9.html-DY1VlJGi.js" as="script"><link rel="prefetch" href="/assets/sticky.html-MHL0s8gx.js" as="script"><link rel="prefetch" href="/assets/sticky2.html-CzsF_AMh.js" as="script"><link rel="prefetch" href="/assets/index.html-CRzPKjLU.js" as="script"><link rel="prefetch" href="/assets/git.html-CpcilJF4.js" as="script"><link rel="prefetch" href="/assets/index.html-CWBbBlf7.js" as="script"><link rel="prefetch" href="/assets/index.html-DQ5lSIWv.js" as="script"><link rel="prefetch" href="/assets/index.html-Bb8DKLFR.js" as="script"><link rel="prefetch" href="/assets/index.html-DIEuZzzE.js" as="script"><link rel="prefetch" href="/assets/index.html-DRiBhfST.js" as="script"><link rel="prefetch" href="/assets/index.html-CAFgDnxc.js" as="script"><link rel="prefetch" href="/assets/index.html-3z2nFrcW.js" as="script"><link rel="prefetch" href="/assets/404.html-6AApxu9U.js" as="script"><link rel="prefetch" href="/assets/index.html-DHrmor8f.js" as="script"><link rel="prefetch" href="/assets/index.html-Cp6_UhVR.js" as="script"><link rel="prefetch" href="/assets/index.html-XtUaYgn0.js" as="script"><link rel="prefetch" href="/assets/index.html-CZF8LZhm.js" as="script"><link rel="prefetch" href="/assets/index.html-Ah7NklYh.js" as="script"><link rel="prefetch" href="/assets/index.html-d4Dd2BP7.js" as="script"><link rel="prefetch" href="/assets/index.html-BWjU4v24.js" as="script"><link rel="prefetch" href="/assets/index.html-qH6uWqYj.js" as="script"><link rel="prefetch" href="/assets/index.html-BnuJKsTB.js" as="script"><link rel="prefetch" href="/assets/index.html-C-4rkza1.js" as="script"><link rel="prefetch" href="/assets/index.html-DurljMkf.js" as="script"><link rel="prefetch" href="/assets/index.html-CFusmB8_.js" as="script"><link rel="prefetch" href="/assets/index.html-D0AimYyP.js" as="script"><link rel="prefetch" href="/assets/index.html-brei7oBq.js" as="script"><link rel="prefetch" href="/assets/index.html-C6Th-S_8.js" as="script"><link rel="prefetch" href="/assets/index-BNnYFWcz.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container external-link-icon"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="logo" src="/images/logo.png" alt="gear"><span class="site-name can-hide" aria-hidden="true">gear</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!---->首页<!----></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a class="route-link route-link-active auto-link" href="/article/web/" aria-label="js框架"><!---->js框架<!----></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/article/web/react/basic/" aria-label="React基础"><!---->React基础<!----></a></li><li class="navbar-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/article/web/react/jinjie/" aria-label="React进阶"><!---->React进阶<!----></a></li><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/article/web/vue/" aria-label="Vue"><!---->Vue<!----></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a class="route-link auto-link" href="/article/web/webyouhua/" aria-label="性能优化"><!---->性能优化<!----></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/article/web/webyouhua/google_font/" aria-label="字体优化-谷歌字体优化"><!---->字体优化-谷歌字体优化<!----></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a class="route-link auto-link" href="/article/tools/" aria-label="工具"><!---->工具<!----></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/article/tools/git/" aria-label="Git"><!---->Git<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="后端"><span class="title">后端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="后端"><span class="title">后端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a class="route-link auto-link" href="/category/server/"><!----><!----><!----></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/category/server/node/" aria-label="Node"><!---->Node<!----></a></li><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/category/server/java/" aria-label="Java"><!---->Java<!----></a></li><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/category/server/python/" aria-label="Python 基础语法"><!---->Python 基础语法<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link auto-link" href="/tag/" aria-label="其他领域"><!---->其他领域<!----></a></div><div class="navbar-item"><a class="route-link auto-link" href="/timeline/" aria-label="时间线"><!---->时间线<!----></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!---->首页<!----></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a class="route-link route-link-active auto-link" href="/article/web/" aria-label="js框架"><!---->js框架<!----></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/article/web/react/basic/" aria-label="React基础"><!---->React基础<!----></a></li><li class="navbar-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/article/web/react/jinjie/" aria-label="React进阶"><!---->React进阶<!----></a></li><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/article/web/vue/" aria-label="Vue"><!---->Vue<!----></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a class="route-link auto-link" href="/article/web/webyouhua/" aria-label="性能优化"><!---->性能优化<!----></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/article/web/webyouhua/google_font/" aria-label="字体优化-谷歌字体优化"><!---->字体优化-谷歌字体优化<!----></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a class="route-link auto-link" href="/article/tools/" aria-label="工具"><!---->工具<!----></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/article/tools/git/" aria-label="Git"><!---->Git<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="后端"><span class="title">后端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="后端"><span class="title">后端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a class="route-link auto-link" href="/category/server/"><!----><!----><!----></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/category/server/node/" aria-label="Node"><!---->Node<!----></a></li><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/category/server/java/" aria-label="Java"><!---->Java<!----></a></li><li class="navbar-dropdown-subitem"><a class="route-link auto-link" href="/category/server/python/" aria-label="Python 基础语法"><!---->Python 基础语法<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link auto-link" href="/tag/" aria-label="其他领域"><!---->其他领域<!----></a></div><div class="navbar-item"><a class="route-link auto-link" href="/timeline/" aria-label="时间线"><!---->时间线<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link auto-link sidebar-item" href="#_1-react-hooks" aria-label="1 React Hooks"><!---->1 React Hooks<!----></a><!----></li><li><a class="route-link auto-link sidebar-item" href="#_2-router路由-react-router-dom-5" aria-label="2 router路由 --react-router-dom@5"><!---->2 router路由 --react-router-dom@5<!----></a><!----></li><li><a class="route-link auto-link sidebar-item" href="#_3-反向代理" aria-label="3  反向代理"><!---->3  反向代理<!----></a><!----></li><li><a class="route-link auto-link sidebar-item" href="#_4-css-module-类似于scoped" aria-label="4 css module 类似于scoped"><!---->4 css module 类似于scoped<!----></a><!----></li><li><a class="route-link auto-link sidebar-item" href="#_5-flux与redux" aria-label="5 Flux与Redux"><!---->5 Flux与Redux<!----></a><!----></li><li><a class="route-link auto-link sidebar-item" href="#_6-实例" aria-label="6 实例"><!---->6 实例<!----></a><!----></li><li><a class="route-link auto-link sidebar-item" href="#_7-react-ts" aria-label="7 react + ts"><!---->7 react + ts<!----></a><!----></li><li><a class="route-link auto-link sidebar-item" href="#_8-单元测试" aria-label="8 单元测试"><!---->8 单元测试<!----></a><!----></li><li><a class="route-link auto-link sidebar-item" href="#_9-redux-soga" aria-label="9 redux-soga"><!---->9 redux-soga<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h3 id="_1-react-hooks" tabindex="-1"><a class="header-anchor" href="#_1-react-hooks"><span>1 <strong>React Hooks</strong></span></a></h3><p><strong>使用</strong>hooks<strong>理由</strong></p><ol><li>高阶组件为了复用，导致代码层级复杂</li><li>生命周期的复杂</li><li>写成functional组件,无状态组件 ，因为需要状态，又改成了class,成本高</li></ol><h4 id="_1-1-usestate-保存组件状态" tabindex="-1"><a class="header-anchor" href="#_1-1-usestate-保存组件状态"><span>1.1 **useState (**保存组件状态)</span></a></h4><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setstate<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>每次setstate 更新， 都会使函数调用一次</p></blockquote><h5 id="根据先前的-state-更新-state" tabindex="-1"><a class="header-anchor" href="#根据先前的-state-更新-state"><span>根据先前的 state 更新 state</span></a></h5><p>假设 <code>age</code> 为 <code>42</code>，这个处理函数三次调用 <code>setAge(age + 1)</code>：</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">function handleClick() {</span>
<span class="line"></span>
<span class="line">  setAge(age + 1); // setAge(42 + 1)</span>
<span class="line"></span>
<span class="line">  setAge(age + 1); // setAge(42 + 1)</span>
<span class="line"></span>
<span class="line">  setAge(age + 1); // setAge(42 + 1)</span>
<span class="line"></span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然而，点击一次后，<code>age</code> 将只会变为 <code>43</code> 而不是 <code>45</code>！这是因为调用 <code>set</code> 函数 <a href="https://zh-hans.react.dev/learn/state-as-a-snapshot" target="_blank" rel="noopener noreferrer">不会更新</a> 已经运行代码中的 <code>age</code> 状态变量。因此，每个 <code>setAge(age + 1)</code> 调用变成了 <code>setAge(43)</code>。</p><p>为了解决这个问题，<strong>你可以向 <code>setAge</code> 传递一个 *更新函数*</strong>，而不是下一个状态：</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">function handleClick() {</span>
<span class="line"></span>
<span class="line">  setAge(a =&gt; a + 1); // setAge(42 =&gt; 43)</span>
<span class="line"></span>
<span class="line">  setAge(a =&gt; a + 1); // setAge(43 =&gt; 44)</span>
<span class="line"></span>
<span class="line">  setAge(a =&gt; a + 1); // setAge(44 =&gt; 45)</span>
<span class="line"></span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2-useeffect-处理副作用-和uselayouteffect-同步执行副作用" tabindex="-1"><a class="header-anchor" href="#_1-2-useeffect-处理副作用-和uselayouteffect-同步执行副作用"><span>1.2 <strong>useEffect(<strong>处理副作用</strong>)<strong>和</strong>useLayoutEffect (<strong>同步执行副作用</strong>)</strong></span></a></h4><p><em>Function Component</em> 不存在生命周期，所以不要把 <em>Class Component</em> 的生命周期概念搬过来试图对号入座。</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">useEffect(() =&gt; {</span>
<span class="line">    //effect</span>
<span class="line">    return () =&gt; {</span>
<span class="line">    //cleanup</span>
<span class="line">    //可以做销毁工作</span>
<span class="line">    };</span>
<span class="line">}, [依赖的状态;空数组,表示不依赖])</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>不要对</strong> <strong>Dependencies</strong> <strong>撒谎</strong>, <strong>如果你明明使用了某个变量，却没有申明在依赖中，你等于向</strong> <strong>React</strong> <strong>撒了谎，后果</strong></p><p><strong>就是，当依赖的变量改变时，<strong>useEffect</strong>也不会再次执行</strong>, eslint<strong>会报警告</strong></p><p><em>Preview</em>页面改造成函数式组件，在路径上从<em>id=1</em>切换到<em>id=2</em>也会自动重新加载，比<em>class</em>组件方便</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">let id = props.match.params.myid</span>
<span class="line">        useEffect(()=&gt;{</span>
<span class="line">        axios.get(`/articles/${id}`).then(res =&gt; {</span>
<span class="line">            settitle(res.data.title)</span>
<span class="line">            setcontent(res.data.content)</span>
<span class="line">            setcategory(res.data.category)</span>
<span class="line">        })</span>
<span class="line">},[id])</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>useEffect</strong>和<strong>useLayoutEffect</strong>有什么区别？</p><p>​ <strong>简单来说就是调用时机不同，</strong> useLayoutEffect <strong>和原来</strong> componentDidMount <strong>&amp;</strong> componentDidUpdate <strong>一致，在</strong></p><p><strong>react</strong>完成<strong>DOM</strong>更新后马上<strong>同步</strong>调用的代码，会阻塞页面渲染。而useEffect <strong>是会在整个页面渲染完才会调用的</strong></p><p><strong>代码。</strong></p><p>​ 官方建议优先使用 useEffect</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">However, we recommend starting with useEffect first and only trying useLayoutEffect if that causes a problem.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>​ 在实际使用时如果想避免<strong>页面抖动</strong>（在 useEffect 里修改DOM很有可能出现）的话，可以把需要操作DOM的代码</p><p>放在 <strong>useLayoutEffect</strong> 里。在这里做点dom操作，这些dom修改会和 react 做出的更改一起被一次性渲染到屏幕</p><p>上，只有一次回流、重绘的代价。</p><h4 id="_1-3-usecallback-记忆函数" tabindex="-1"><a class="header-anchor" href="#_1-3-usecallback-记忆函数"><span>1.3 **useCallback(**记忆函数)</span></a></h4><p>防止因为组件重新渲染，导致方法被重新创建 ，起到缓存作用*;* 只有第二个参数 变化了，才重新声明一次</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">var handleClick = useCallback(()=&gt;{</span>
<span class="line">	console.log(name)</span>
<span class="line">},[name])</span>
<span class="line">&lt;button onClick={()=&gt;handleClick()}&gt;hello&lt;/button&gt;</span>
<span class="line">//只有name改变后， 这个函数才会重新声明一次，</span>
<span class="line">//如果传入空数组， 那么就是第一次创建后就被缓存， 如果name后期改变了,拿到的还是老的name。</span>
<span class="line">//如果不传第二个参数，每次都会重新声明一次，拿到的就是最新的name.</span>
<span class="line">const setText = useCallback((e) =&gt;{</span>
<span class="line">    console.log(e.target.value)</span>
<span class="line">    setNav(e.target.value)</span>
<span class="line">}, []) // 空数组的含义 里面的代码还是以前的</span>
<span class="line"></span>
<span class="line">  return (</span>
<span class="line">    &lt;div&gt;</span>
<span class="line">        &lt;input onChange={setText} value={nav}&gt;&lt;/input&gt;</span>
<span class="line">        &lt;button onClick={setList}&gt;add&lt;/button&gt;</span>
<span class="line">        &lt;div&gt;</span>
<span class="line">            &lt;ul&gt;</span>
<span class="line">                {</span>
<span class="line">                    ListData.map((item, index) =&gt; {</span>
<span class="line">                        return &lt;li key={index}&gt;{item}&lt;/li&gt;</span>
<span class="line">                    })</span>
<span class="line">                }</span>
<span class="line">            &lt;/ul&gt;</span>
<span class="line">            &lt;span&gt;</span>
<span class="line">                总计：{ count }</span>
<span class="line">            &lt;/span&gt;</span>
<span class="line">        &lt;/div&gt;</span>
<span class="line">    &lt;/div&gt;</span>
<span class="line">  )</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-usememo-记忆组件" tabindex="-1"><a class="header-anchor" href="#_1-4-usememo-记忆组件"><span>1.4 <strong>useMemo</strong> <strong>记忆组件</strong></span></a></h4><p>​ useCallback 的功能完全可以由 useMemo 所取代，如果你想通过使用 useMemo 返回一个记忆函数也是完全可以</p><p>的。</p><p>​ 唯一的区别是：<strong>useCallback</strong> <strong>不会执行第一个参数函数，而是将它返回给你，而</strong> <strong>useMemo</strong> <strong>会执行第一个函数并</strong></p><p>**且将函数执行结果返回给你。**所以在前面的例子中，可以返回 handleClick 来达到存储函数的目的。</p><p>​ 所以 useCallback 常用记忆事件函数，生成记忆后的事件函数并传递给子组件使用。而 useMemo 更适合经过函数</p><p>计算得到一个确定的值，比如记忆组件。</p><h4 id="_1-5-useref-保存引用值" tabindex="-1"><a class="header-anchor" href="#_1-5-useref-保存引用值"><span>1.5 <strong>useRef(<strong>保存引用值</strong>)</strong></span></a></h4><p>​ 1. 组件对象</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">const inputRef = useRef(null) </span>
<span class="line">&lt;input onChange={setText} value={nav} ref={inputRef}&gt;&lt;/input&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 2.保存变量</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">let</span> changeCount <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">changeCount<span class="token punctuation">.</span>current<span class="token operator">++</span></span>
<span class="line"><span class="token punctuation">{</span> changeCount<span class="token punctuation">.</span>current <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 参数</p><ul><li><code>initialValue</code>：ref 对象的 <code>current</code> 属性的初始值。可以是任意类型的值。这个参数在首次渲染后被忽略。</li></ul><p>​ 返回值</p><p>​ <code>useRef</code> 返回一个只有一个属性的对象:</p><ul><li><code>current</code>：初始值为传递的 <code>initialValue</code>。之后可以将其设置为其他值。如果将 ref 对象作为一个 JSX 节点的 <code>ref</code> 属性传递给 React，React 将为它设置 <code>current</code> 属性。</li></ul><p>​ 在后续的渲染中，<code>useRef</code> 将返回同一个对象。</p><h4 id="_1-6-usereducer和usecontext-减少组件层级" tabindex="-1"><a class="header-anchor" href="#_1-6-usereducer和usecontext-减少组件层级"><span>1.6 <strong>useReducer</strong>和<strong>useContext(<strong>减少组件层级</strong>)</strong></span></a></h4><p>​ useContext</p><p>​ const value = useContext(SomeContext)</p><p>​ 可以让你读取和订阅组件中的 <a href="https://react.docschina.org/learn/passing-data-deeply-with-context" target="_blank" rel="noopener noreferrer">context</a>。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">import { useContext } from &#39;react&#39;;</span>
<span class="line"></span>
<span class="line">function MyComponent() {</span>
<span class="line">  const theme = useContext(ThemeContext);</span>
<span class="line">  // ...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>SomeContext</code>：先前用 <a href="https://react.docschina.org/reference/react/createContext" target="_blank" rel="noopener noreferrer"><code>createContext</code></a> 创建的 context。context 本身不包含信息，它只代表你可以提供或从组件中读取的信息类型。</li></ul><p>​ <code>useContext</code> 为调用组件返回 context 的值。它被确定为传递给树中调用组件上方最近的 <code>SomeContext.Provider</code> 的 <code>value</code>。如果没有这样的 provider，那么返回值将会是为创建该 context 传递给 <a href="https://react.docschina.org/reference/react/createContext" target="_blank" rel="noopener noreferrer"><code>createContext</code></a> 的 <code>defaultValue</code>。返回的值始终是最新的。如果 context 发生变化，React 会自动重新渲染读取 context 的组件。</p><p>​ useReducer</p><p>​ 在组件的顶层作用域调用 <code>useReducer</code> 以创建一个用于管理状态的 <a href="https://react.docschina.org/learn/extracting-state-logic-into-a-reducer" target="_blank" rel="noopener noreferrer">reducer</a>。</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">import { useReducer } from &#39;react&#39;;</span>
<span class="line"></span>
<span class="line">function reducer(state, action) {</span>
<span class="line">  // ...</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">function MyComponent() {</span>
<span class="line">  const [state, dispatch] = useReducer(reducer, { age: 42 });</span>
<span class="line">  // ...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ <code>useReducer</code> 返回一个由两个值组成的数组：</p><ol><li>当前的 state，首次渲染时为你提供的 初始值。</li><li><code>dispatch</code> 函数，让你可以根据交互修改 state。</li></ol><h3 id="_2-router路由-react-router-dom-5" tabindex="-1"><a class="header-anchor" href="#_2-router路由-react-router-dom-5"><span>2 router路由 --react-router-dom@5</span></a></h3><h4 id="_1-路由方法导入" tabindex="-1"><a class="header-anchor" href="#_1-路由方法导入"><span><strong>(1)</strong> <strong>路由方法导入</strong></span></a></h4><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">import React from &quot;react&quot;;</span>
<span class="line">import {</span>
<span class="line">    BrowserRouter as Router,</span>
<span class="line">    Switch,</span>
<span class="line">    Route,</span>
<span class="line">    Link</span>
<span class="line">} from &quot;react-router-dom&quot;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-定义路由以及重定向" tabindex="-1"><a class="header-anchor" href="#_2-定义路由以及重定向"><span><strong>(2)</strong> <strong>定义路由以及重定向</strong></span></a></h4><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">&lt;HashRouter&gt;</span>
<span class="line">    &lt;Switch&gt;</span>
<span class="line">        &lt;Route path=&quot;/films&quot; component={Films}/&gt;</span>
<span class="line">        &lt;Route path=&quot;/cinemas&quot; component={Cinemas}/&gt;</span>
<span class="line">        &lt;Route path=&quot;/center&quot; component={Center}/&gt;</span>
<span class="line">        {/* 重定向 */}</span>
<span class="line">        &lt;Redirect from=&quot;/&quot; to=&quot;/films&quot; /&gt;</span>
<span class="line">        {/* &lt;Redirect from=&quot;/&quot; to=&quot;/films&quot; exact/&gt;</span>
<span class="line">        {/* 页面不对处理 */}</span>
<span class="line">        &lt;Route path=&quot;*&quot; component={NotFound}/&gt; */}</span>
<span class="line">    &lt;/Switch&gt;</span>
<span class="line">&lt;/HashRouter&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ b. exact 精确匹配 (Redirect 即使使用了exact, 外面还要嵌套Switch 来用)</p><pre><code>	c. Warning: Hash history cannot PUSH the same path; a new entry will not be added to the history
</code></pre><p>​ stack,这个警告只有在hash 模式会出现。</p><h4 id="_3-嵌套路由" tabindex="-1"><a class="header-anchor" href="#_3-嵌套路由"><span><strong>(3)</strong> <strong>嵌套路由</strong></span></a></h4><p>​ 在一级路由组件中书写</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">&lt;Switch&gt;</span>
<span class="line">    &lt;Route path=&quot;/films/nowplaying&quot; component={Nowplaying}/&gt;</span>
<span class="line">    &lt;Route path=&quot;/films/comingsoon&quot; component={Comingsoon}/&gt;</span>
<span class="line">    &lt;Redirect from=&quot;/films&quot; to=&quot;/films/nowplaying&quot;/&gt;</span>
<span class="line">&lt;/Switch&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-路由跳转方式" tabindex="-1"><a class="header-anchor" href="#_4-路由跳转方式"><span><strong>(4)</strong> 路由跳转方式</span></a></h4><p>​ a. 声明式导航</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">&lt;NavLink to=&quot;/films&quot; activeClassName=&quot;active&quot;&gt;films&lt;/NavLink&gt;</span>
<span class="line">&lt;NavLink to=&quot;/cinemas&quot; activeClassName=&quot;active&quot;&gt;cinemas&lt;/NavLink&gt;</span>
<span class="line">&lt;NavLink to=&quot;/center&quot; activeClassName=&quot;active&quot;&gt;center&lt;/NavLink&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ b. 编程式导航</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token comment">// 类组件</span></span>
<span class="line"><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/center</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// 原生</span></span>
<span class="line">window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">&quot;#/detail/&quot;</span> <span class="token operator">+</span> id</span>
<span class="line"><span class="token comment">// 函数组件</span></span>
<span class="line">prop<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/detail/${id}&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 1. 使用 <code>&lt;Link&gt;</code> 组件</p><p>​ <code>&lt;Link&gt;</code> 组件用于在渲染静态页面时创建导航链接。这种方式类似于 HTML 中的 <code>&lt;a&gt;</code> 标签，但不会触发页面刷新。</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">import { Link } from &#39;react-router-dom&#39;;</span>
<span class="line"></span>
<span class="line">const Navigation = () =&gt; (</span>
<span class="line">  &lt;nav&gt;</span>
<span class="line">    &lt;Link to=&quot;/home&quot;&gt;Home&lt;/Link&gt;</span>
<span class="line">    &lt;Link to=&quot;/about&quot;&gt;About&lt;/Link&gt;</span>
<span class="line">  &lt;/nav&gt;</span>
<span class="line">);</span>
<span class="line"></span>
<span class="line">export default Navigation;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>		2. 使用 `useNavigate` 钩子
</code></pre><p>​ <code>useNavigate</code> 是 React Router v6 引入的一个钩子，用于编程式导航。它替代了 v5 的 <code>useHistory</code> 钩子。</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">import { useNavigate } from &#39;react-router-dom&#39;;</span>
<span class="line"></span>
<span class="line">const MyComponent = () =&gt; {</span>
<span class="line">  const navigate = useNavigate();</span>
<span class="line"></span>
<span class="line">  const goToHome = () =&gt; {</span>
<span class="line">    navigate(&#39;/home&#39;);</span>
<span class="line">  };</span>
<span class="line"></span>
<span class="line">  return &lt;button onClick={goToHome}&gt;Go Home&lt;/button&gt;;</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line">export default MyComponent;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>		3. 使用 `&lt;Navigate&gt;` 组件
</code></pre><p>​ <code>&lt;Navigate&gt;</code> 组件用于在渲染时重定向用户到另一个路径。它适用于需要在 JSX 中直接进行条件性导航的场景。</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">import { Navigate } from &#39;react-router-dom&#39;;</span>
<span class="line"></span>
<span class="line">const MyComponent = ({ isLoggedIn }) =&gt; {</span>
<span class="line">  if (!isLoggedIn) {</span>
<span class="line">    return &lt;Navigate to=&quot;/login&quot; /&gt;;</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  return &lt;div&gt;Welcome!&lt;/div&gt;;</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line">export default MyComponent;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li><p>使用 <code>navigate</code> 函数</p><p>在一些特定的场景下，比如在非组件函数中，你可以使用 <code>useNavigate</code> 获取的 <code>navigate</code> 函数进行跳转。</p></li></ol><div class="language-jsx line-numbers-mode" data-ext="jsx" data-title="jsx"><pre class="language-jsx"><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useNavigate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-router-dom&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">SomeFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> navigate <span class="token operator">=</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string">&#39;/some-path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Go Somewhere</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>	5. 使用 `history` 对象 (React Router v5)
</code></pre><p>​ 在 React Router v5 中，<code>history</code> 对象用来进行编程式导航。在 v6 中已经被 <code>useNavigate</code> 所取代。</p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">import { useHistory } from &#39;react-router-dom&#39;;</span>
<span class="line"></span>
<span class="line">const MyComponent = () =&gt; {</span>
<span class="line">  const history = useHistory();</span>
<span class="line"></span>
<span class="line">  const goToHome = () =&gt; {</span>
<span class="line">    history.push(&#39;/home&#39;);</span>
<span class="line">  };</span>
<span class="line"></span>
<span class="line">  return &lt;button onClick={goToHome}&gt;Go Home&lt;/button&gt;;</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line">export default MyComponent;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 总结</p><ol><li><code>&lt;Link&gt;</code> 组件 - 静态导航链接。</li><li><code>useNavigate</code> 钩子 - 编程式导航（v6）。</li><li><code>&lt;Navigate&gt;</code> 组件 - 条件性导航。</li><li><code>navigate</code> 函数 - 编程式导航（v6 非组件函数中）。</li><li><code>history</code> 对象 - 编程式导航（v5）。</li></ol><h4 id="_5-路由传参" tabindex="-1"><a class="header-anchor" href="#_5-路由传参"><span><strong>(5)</strong> <strong>路由传参</strong></span></a></h4><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> query 传参</span>
<span class="line"><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">pathname</span> <span class="token operator">:</span> <span class="token string">&#39;/user&#39;</span> <span class="token punctuation">,</span><span class="token literal-property property">query</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">day</span><span class="token operator">:</span> <span class="token string">&#39;Friday&#39;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>location<span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token function">day</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> state 传参 有一种问题 得有缓存</span>
<span class="line"><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">pathname</span><span class="token operator">:</span><span class="token string">&#39;/user&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">state</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">day</span> <span class="token operator">:</span> <span class="token string">&#39;Friday&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>location<span class="token punctuation">.</span>state<span class="token punctuation">.</span>day</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-路由拦截" tabindex="-1"><a class="header-anchor" href="#_6-路由拦截"><span><strong>(6)</strong> <strong>路由拦截</strong></span></a></h4><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/center&quot;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">isAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token operator">&lt;</span>Center<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token operator">&lt;</span>Login<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_7-路由器分类" tabindex="-1"><a class="header-anchor" href="#_7-路由器分类"><span><strong>(7)</strong> <strong>路由器分类</strong></span></a></h4><p>​ <code>&lt;BrowserRouter&gt;</code>使用干净的 URL 将当前位置存储在浏览器的地址栏中，并使用浏览器的内置历史记录堆栈进行导航。</p><p>​ <code>&lt;HashRouter&gt;</code>用于 Web 浏览器，当 URL 由于某种原因不应（或无法）发送到服务器时。在某些共享主机情况下，您可能会发生这种情况，因为您无法完全控制服务器。在这些情况下，<code>&lt;HashRouter&gt;</code>可以将当前位置存储在<code>hash</code>当前 URL 的一部分中，因此永远不会将其发送到服务器。</p><h4 id="_8-withrouter的应用与原理" tabindex="-1"><a class="header-anchor" href="#_8-withrouter的应用与原理"><span><strong>(8) withRouter</strong>的应用与原理</span></a></h4><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">import { withRouter } from &quot;react-router&quot;;</span>
<span class="line">withRouter(MyComponent);</span>
<span class="line">withRouter(connect(...)(MyComponent))</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 将该组件包裹进Route里面, 然后通过props就可以访问到history, location, match三个对象</p><h3 id="_3-反向代理" tabindex="-1"><a class="header-anchor" href="#_3-反向代理"><span>3 反向代理</span></a></h3><p>​ https://facebook.github.io/create-react-app/docs/proxying-api-requests-in-development</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">npm install http<span class="token operator">-</span>proxy<span class="token operator">-</span>middleware <span class="token operator">--</span>save</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> createProxyMiddleware <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;http-proxy-middleware&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&#39;/api&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">createProxyMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;http://localhost:5000&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-css-module-类似于scoped" tabindex="-1"><a class="header-anchor" href="#_4-css-module-类似于scoped"><span>4 <strong>css module</strong> 类似于scoped</span></a></h3><p>https://facebook.github.io/create-react-app/docs/adding-a-css-modules-stylesheet</p><p>类似这样建立</p><p><img src="/assets/Snipaste_2024-06-20_14-08-01-3CjRI1Xu.png" alt=""></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">&#39;./css/styles.module.less&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_5-flux与redux" tabindex="-1"><a class="header-anchor" href="#_5-flux与redux"><span>5 <strong>Flux</strong>与<strong>Redux</strong></span></a></h3><p>​ Flux是Facebook提出的一种架构模式，主要用于解决React应用中组件之间状态管理的问题</p><p>​ Redux是受Flux启发的状态管理库，但它做了一些简化和改进，使得状态管理更加直观和可预测</p><p>​ Flux:</p><p>​ <img src="/assets/Snipaste_2024-06-06_17-14-08-DfxvDDyt.png" alt=""></p><p>Redux最主要是用作应用状态的管理。简言之，Redux用一个单独的常量状态树（state对象）保存这一整个应用的</p><p>状态，这个对象不能直接被改变。当一些数据变化了，一个新的对象就会被创建（使用actions和reducers），这</p><p>样就可以进行数据追踪，实现时光旅行。</p><p>​ <strong>redux</strong> <strong>介绍及设计和使用的三大原则</strong></p><p><img src="/assets/Snipaste_2024-06-04_15-57-39-C_dJgzKj.png" alt=""></p><p>实例运用</p><p><img src="/assets/Snipaste_2024-06-06_23-25-53-CEOW_Nnj.png" alt=""></p><h4 id="_5-1-reducer" tabindex="-1"><a class="header-anchor" href="#_5-1-reducer"><span>5.1 Reducer<a href="https://cn.redux.js.org/tutorials/essentials/part-1-overview-concepts#reducer" target="_blank" rel="noopener noreferrer"></a></span></a></h4><p><strong>reducer</strong> 是一个函数，接收当前的 <code>state</code> 和一个 <code>action</code> 对象，必要时决定如何更新状态，并返回新状态。函数签名是：<code>(state, action) =&gt; newState</code>。 <strong>你可以将 reducer 视为一个事件监听器，它根据接收到的 action（事件）类型处理事件</strong></p><div class="language-react line-numbers-mode" data-ext="react" data-title="react"><pre class="language-react"><code><span class="line">const initialState = { value: 0 }</span>
<span class="line"></span>
<span class="line">function counterReducer(state = initialState, action) {</span>
<span class="line">  // 检查 reducer 是否关心这个 action</span>
<span class="line">  if (action.type === &#39;counter/increment&#39;) {</span>
<span class="line">    // 如果是，复制 `state`</span>
<span class="line">    return {</span>
<span class="line">      ...state,</span>
<span class="line">      // 使用新值更新 state 副本</span>
<span class="line">      value: state.value + 1</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line">  // 返回原来的 state 不变</span>
<span class="line">  return state</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**4. redux ** <strong>原理解析</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">store 是通过 createStore创建出来的，</span>
<span class="line">所以他的结构</span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createStore</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span> initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token operator">...</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">            dispatch<span class="token punctuation">,</span> 用于action的分发，</span>
<span class="line">            改变store里面的state</span>
<span class="line">            （currentState <span class="token operator">=</span>	<span class="token function">reducer</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span>action<span class="token punctuation">)</span>） ，并在内部遍历subcribe注册的监听器</span>
<span class="line">            subscribe<span class="token punctuation">,</span>注册listener，</span>
<span class="line">            store里面state发生改变后，执行该</span>
<span class="line">            listener</span>
<span class="line">            getState<span class="token punctuation">,</span> 取store里面的</span>
<span class="line">            state</span>
<span class="line">        <span class="token operator">...</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token parameter">reducer</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">var</span> state <span class="token operator">=</span><span class="token function">reducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">   	 list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    	state <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    	<span class="token keyword">return</span> state<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        subscribe<span class="token punctuation">,</span></span>
<span class="line">        dispatch<span class="token punctuation">,</span></span>
<span class="line">        getState</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5. reducer</strong> <strong>扩展</strong></p><p>​ 如果如果不同的action所处理的属性之间没有联系，我们可以把 Reducer 函数拆分。不同的函数</p><p>​ 负责处理不同属性，最终把它们合并成一个大的 Reducer 即可</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>combineReducers<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">a</span><span class="token operator">:</span> functionA<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">b</span><span class="token operator">:</span> functionB<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">c</span><span class="token operator">:</span> functionC</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">访问：</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">kerwinstate</span><span class="token operator">:</span>state<span class="token punctuation">.</span><span class="token function">a</span> <span class="token punctuation">(</span>不同的命名空间<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-实例" tabindex="-1"><a class="header-anchor" href="#_6-实例"><span>6 实例<img src="/assets/Snipaste_2024-06-07_11-10-24-r78tgvcU.png" alt=""></span></a></h3><p><img src="/assets/Snipaste_2024-06-07_11-11-18-BzUfxaDc.png" alt=""></p><p>**6. redux ** <strong>中间件</strong></p><p>在redux里，action仅仅是携带了数据的普通js对象。action creator返回的值是这个action类型的</p><p>对象。然后通过store.dispatch()进行分发。同步的情况下一切都很完美，但是reducer无法处理异</p><p>步的情况。</p><p>那么我们就需要在action和reducer中间架起一座桥梁来处理异步。这就是middleware。</p><p><strong>i.</strong> <strong>中间件的由来与原理、机制</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">thunkMiddleware</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> getState <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token parameter">next</span> <span class="token operator">=&gt;</span> <span class="token parameter">action</span> <span class="token operator">=&gt;</span></span>
<span class="line">    <span class="token keyword">typeof</span> action <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span> <span class="token operator">?</span></span>
<span class="line">    <span class="token function">action</span><span class="token punctuation">(</span>dispatch<span class="token punctuation">,</span> getState<span class="token punctuation">)</span> <span class="token operator">:</span></span>
<span class="line">    <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码的意思是，中间件这个桥梁接受到的参数action，如果不是function则和过去一样直接执</p><p>行next方法(下一步处理)，相当于中间件没有做任何事。如果action是function，则先执行action，</p><p>action的处理结束之后，再在action的内部调用dispatch。</p><p><strong>ii.</strong> <strong>常用异步中间件：</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">&#39;redux-thunk&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>applyMiddleware<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>fetchReducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">getComingSoon</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//进行异步请求</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span>store</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b. redux-promise (store.dispatch参数可以是一个promise对象)</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">import</span> promiseMiddleware <span class="token keyword">from</span> <span class="token string">&#39;redux-promise&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>fetchReducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">,</span>promiseMiddleware<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">getComingSoon</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//进行异步请求</span></span>
<span class="line">    <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">****</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&quot;cominglist&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">info</span><span class="token operator">:</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>7. Redux DevTools Extension</strong></p><p>https://github.com/zalmoxisus/redux-devtools-extension</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> compose<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span></span>
<span class="line"><span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">&#39;./reducer&#39;</span></span>
<span class="line"><span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span> window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ <span class="token operator">||</span> compose<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token comment">/* preloadedState, */</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> store</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**十二 ** <strong>. react-redux</strong></p><p>1 **容器组件与 ** <strong>UI</strong> <strong>组件</strong></p><p>（1）UI组件</p><p>•只负责 UI 的呈现，不带有任何业务逻辑</p><p>•没有状态（即不使用this.state这个变量）</p><p>•所有数据都由参数（this.props）提供</p><p>•不使用任何 Redux 的 API</p><p>(2) 容器组件</p><p>•负责管理数据和业务逻辑，不负责 UI 的呈现</p><p>•带有内部状态</p><p>•使用 Redux 的 API</p><p><strong>Provider</strong> <strong>与</strong> <strong>connect</strong></p><p>（1）React-Redux 提供Provider组件，可以让容器组件拿到state。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#39;react-dom&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span></span>
<span class="line"><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&#39;./store&#39;</span></span>
<span class="line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App&#39;</span></span>
<span class="line"><span class="token keyword">const</span> rootElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span></span>
<span class="line">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">	rootElement</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）React-Redux 提供connect方法，用于从 UI 组件生成容器组件。connect的意思，就是将这</p><p>两种组件连起来</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> reset <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./actionCreators&#39;</span></span>
<span class="line"><span class="token comment">// const Counter = ...</span></span>
<span class="line"><span class="token keyword">const</span> mapStateToProps <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token comment">/*, ownProps*/</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> mapDispatchToProps <span class="token operator">=</span> <span class="token punctuation">{</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> reset <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span></span>
<span class="line">    mapStateToProps<span class="token punctuation">,</span></span>
<span class="line">    mapDispatchToProps</span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4. HOC</strong> <strong>与</strong> <strong>context</strong> <strong>通信在</strong> <strong>react-redux</strong> <strong>底层中的应用</strong></p><p>(1) connect 是HOC， 高阶组件</p><p>(2) Provider组件，可以让容器组件拿到state ， 使用了context</p><p><strong>5.</strong> <strong>高阶组件构建与应用</strong></p><p>HOC不仅仅是一个方法，确切说应该是一个组件工厂，获取低阶组件，生成高阶组件。</p><p>(1)代码复用，代码模块化</p><p>(2)增删改props</p><p>(3) 渲染劫持</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">// Child.js</span>
<span class="line">//高阶函数</span>
<span class="line">function Control(wrappedComponent) {</span>
<span class="line">	return class MyControl extends React.Component {</span>
<span class="line">    render(){</span>
<span class="line">    if(!this.props.data) {</span>
<span class="line">        return &lt;div&gt;loading...&lt;/div&gt;</span>
<span class="line">        }</span>
<span class="line">        return &lt;wrappedComponent {...props} /&gt;</span>
<span class="line">        }</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">    class MyComponent extends React.Component {</span>
<span class="line">        render(){</span>
<span class="line">        return &lt;div&gt;{this.props.data}&lt;/div&gt;</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">export default Control(MyComponent); //高阶组件</span>
<span class="line">//Parent.js</span>
<span class="line">import MyControlComponent from &quot;./Child&quot;</span>
<span class="line">&lt;MyControlComponent data={this.state.value}/&gt;</span>
<span class="line">//在父级传入data是null的时候，这一块儿就只会显示loading...,</span>
<span class="line">//不会显示组件的具体内容，如果data不为null, 就显示真实组件信息。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>6. Redux</strong> <strong>持久化</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>persistStore<span class="token punctuation">,</span> persistReducer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux-persist&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> storage <span class="token keyword">from</span> <span class="token string">&#39;redux-persist/lib/storage&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> autoMergeLevel2 <span class="token keyword">from</span> <span class="token string">&#39;redux-persist/lib/stateReconciler/autoMergeLevel2&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> persistConfig <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;kerwin&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">storage</span><span class="token operator">:</span> storage<span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">//localStorage: import storage from &#39;redux-persist/lib/storage&#39;</span></span>
<span class="line">    <span class="token comment">//sessionStorage: import storageSession from &#39;redux-persist/lib/storage/session&#39;</span></span>
<span class="line">    <span class="token literal-property property">stateReconciler</span><span class="token operator">:</span> autoMergeLevel2</span>
<span class="line">    <span class="token comment">//控制在本地存储中，新老状态怎么合并，覆盖？或者合并？</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//改造reducer</span></span>
<span class="line">    <span class="token keyword">const</span> myPersistReducer <span class="token operator">=</span> <span class="token function">persistReducer</span><span class="token punctuation">(</span>persistConfig<span class="token punctuation">,</span> reducer<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">//改造store</span></span>
<span class="line">    <span class="token keyword">export</span> <span class="token keyword">const</span> persistor <span class="token operator">=</span> <span class="token function">persistStore</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">//改造根组件</span></span>
<span class="line">    <span class="token keyword">import</span> <span class="token punctuation">{</span>persistor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./Store&#39;</span></span>
<span class="line">    <span class="token keyword">import</span> <span class="token punctuation">{</span>PersistGate<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux-persist/lib/integration/react&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">&lt;</span>PersistGate loading<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">null</span><span class="token punctuation">}</span> persistor<span class="token operator">=</span><span class="token punctuation">{</span>persistor<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">    	<span class="token operator">...</span></span>
<span class="line">	<span class="token operator">&lt;</span><span class="token operator">/</span>PersistGate<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-react-ts" tabindex="-1"><a class="header-anchor" href="#_7-react-ts"><span>7 react + ts</span></a></h3><h4 id="_7-1-class" tabindex="-1"><a class="header-anchor" href="#_7-1-class"><span>7.1 class</span></a></h4><p>​ state</p><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">IState</span> <span class="token punctuation">{</span></span>
<span class="line">    name<span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">// &lt;属性,状态&gt;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> IState<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">    state <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        name<span class="token operator">:</span> <span class="token string">&#39;100&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">                APP: </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="line">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;200&#39;</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">edit</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ props</p><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Children<span class="token punctuation">,</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span></span>
<span class="line">    show<span class="token operator">:</span> <span class="token builtin">boolean</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> Iprops<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">    state <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        show<span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">show</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">change text</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ChildComponet</span></span> <span class="token attr-name">show</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>show<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ChildComponet</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ChildComponet</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span>Iprops<span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">            </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>show <span class="token operator">?</span> <span class="token string">&#39;01-抽屉&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;02-桌子&#39;</span><span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-2-hooks-react-16-8-新增" tabindex="-1"><a class="header-anchor" href="#_7-2-hooks-react-16-8-新增"><span>7.2 hooks （react@16.8 新增）</span></a></h4><p>​ state</p><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token comment">//rfc</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Comstate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#39;chuck&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">name: </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&#39;123&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">edit Name</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-3-父子间通信" tabindex="-1"><a class="header-anchor" href="#_7-3-父子间通信"><span>7.3 父子间通信</span></a></h4><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="line"><span class="token comment">//父组件调用</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span> <span class="token attr-name">item</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span> <span class="token attr-name">index</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span> <span class="token attr-name">cb</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> newlist<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>list<span class="token punctuation">]</span></span>
<span class="line">        newlist<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">setList</span><span class="token punctuation">(</span>newlist<span class="token punctuation">)</span></span>
<span class="line"> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token comment">//子组件</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">ItemType</span><span class="token punctuation">{</span></span>
<span class="line">    item<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">    index<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token comment">//定义接口</span></span>
<span class="line">    <span class="token function-variable function">cb</span><span class="token operator">:</span><span class="token punctuation">(</span>param<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">void</span> <span class="token comment">//定义接口</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token operator">:</span>ItemType<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span>index<span class="token punctuation">,</span>item<span class="token punctuation">,</span>cb<span class="token punctuation">}</span> <span class="token operator">=</span> props</span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> 	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="line">   		 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">cb</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">del-</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-4-路由" tabindex="-1"><a class="header-anchor" href="#_7-4-路由"><span>7.4 路由</span></a></h4><p><strong>编程式导航</strong></p><div class="language-TSX line-numbers-mode" data-ext="TSX" data-title="TSX"><pre class="language-TSX"><code><span class="line">// 使用编程式导航，需要引入接口配置</span>
<span class="line">import { RouteComponentProps } from &quot;react-router-dom&quot;;</span>
<span class="line">interface IProps {自己定义的接口}</span>
<span class="line">type HomeProps = IProps &amp; RouteComponentProps; //两个接口属性都支持</span>
<span class="line">interface IState {}</span>
<span class="line">class Home extends React.Component&lt;HomeProps, IState&gt; {</span>
<span class="line">    private handleSubmit = async () =&gt; {</span>
<span class="line">        //code for API calls</span>
<span class="line">        this.props.history.push(&quot;/home&quot;);</span>
<span class="line">    };</span>
<span class="line">    public render(): any {</span>
<span class="line">   		 return &lt;div&gt;Hello&lt;/div&gt;;</span>
<span class="line">    }</span>
<span class="line"> }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>动态路由</strong></p><div class="language-TSX line-numbers-mode" data-ext="TSX" data-title="TSX"><pre class="language-TSX"><code><span class="line">interface IParams{</span>
<span class="line">id:string</span>
<span class="line">}</span>
<span class="line">// RouteComponentProps是一个泛型接口</span>
<span class="line">class Detail extends Component&lt; RouteComponentProps&lt;IParams&gt; &gt;{</span>
<span class="line">    componentDidMount() {</span>
<span class="line">    	console.log(this.props.match.params.id)</span>
<span class="line">	}</span>
<span class="line">    render(){</span>
<span class="line">        return &lt;div&gt;</span>
<span class="line">        detail</span>
<span class="line">        &lt;/div&gt;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-单元测试" tabindex="-1"><a class="header-anchor" href="#_8-单元测试"><span>8 单元测试</span></a></h3><p>使用 React Testing Library 官网推荐</p><p>文档地址 https://testing-library.com/docs/react-testing-library/intro</p><p>好处：</p><p><strong>提高代码质量</strong>：测试库能够帮助开发人员编写和运行自动化测试，从而尽早发现和修复潜在的代码问题。这样可以提高代码质量，减少 bug 数量，并降低维护成本</p><p><strong>加速反馈循环</strong>：在快节奏的开发中，快速获得反馈非常重要。自动化测试可以帮助开发人员快速验证他们的更改是否带来了意外的影响，从而加速开发和部署流程</p><p><strong>减少回归测试</strong></p><p>安装</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev @testing<span class="token operator">-</span>library<span class="token operator">/</span>react @testing<span class="token operator">-</span>library<span class="token operator">/</span>dom</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_8-1-介绍" tabindex="-1"><a class="header-anchor" href="#_8-1-介绍"><span>8.1 介绍</span></a></h4><p>React 初学者经常会混淆 React 中的测试工具。React Testing Library 不是 Jest 的替代品，因为它们互相需要，而且每个工具都有明确的任务。</p><h4 id="_8-2-常用api介绍" tabindex="-1"><a class="header-anchor" href="#_8-2-常用api介绍"><span>8.2 常用API介绍</span></a></h4><ol><li><strong>Render 方法</strong>：用于将 React 组件渲染到虚拟 DOM 中，并返回一个包含渲染结果的对象，你可以对这个对象进行断言和查询。</li><li><strong>Queries</strong>：一组用于查询和断言组件行为的方法，比如 getByLabelText、getByText、queryByTestId 等。通过这些方法，你可以在渲染结果中查找特定的元素，并断言它们的存在或内容。</li></ol><p>​ <code>screen.getAllByRole</code> 方法接受一个角色字符串作为参数，并返回一个包含所有符合条件的元素数组</p><p>​ Role</p><blockquote><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">在网页中，<span class="token constant">HTML</span>元素的角色（role）是基于<span class="token constant">ARIA</span>规范（Accessible Rich Internet Applications）定义的。<span class="token constant">ARIA</span>角色用于增强网页的可访问性，使得屏幕阅读器和其他辅助技术能够更好地理解和与网页元素进行交互。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在ARIA规范中，每个HTML元素都有一个默认的角色。例如：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token operator">&lt;</span>button<span class="token operator">&gt;</span> 元素的默认角色是 button。</span>
<span class="line"><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span> 元素（当有 href 属性时）的默认角色是 link。</span>
<span class="line"><span class="token operator">&lt;</span>input<span class="token operator">&gt;</span> 元素（当 type 为 text 时）的默认角色是 textbox。</span>
<span class="line"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></span>
<span class="line">对于 <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span> 元素，其默认角色是 listitem。这是因为 <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span> 元素通常用于定义列表项，而 listitem 角色正是用来表示这一点的。</span>
<span class="line">以下是一些常见<span class="token constant">HTML</span>元素及其默认角色：</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span> 和 <span class="token operator">&lt;</span>ol<span class="token operator">&gt;</span>：默认角色是 list</span>
<span class="line"><span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>：默认角色是 listitem</span>
<span class="line"><span class="token operator">&lt;</span>nav<span class="token operator">&gt;</span>：默认角色是 navigation</span>
<span class="line"><span class="token operator">&lt;</span>header<span class="token operator">&gt;</span>：默认角色是 banner</span>
<span class="line"><span class="token operator">&lt;</span>footer<span class="token operator">&gt;</span>：默认角色是 contentinfo</span>
<span class="line"><span class="token operator">&lt;</span>main<span class="token operator">&gt;</span>：默认角色是 main</span>
<span class="line"><span class="token operator">&lt;</span>section<span class="token operator">&gt;</span>：默认角色是 region（如果有 aria<span class="token operator">-</span>labelledby 或 aria<span class="token operator">-</span>label 属性）</span>
<span class="line">React Testing Library 的 getAllByRole 方法利用这些默认角色来查找元素。这有助于确保测试代码关注的是用户界面中实际存在的、对用户可见且可访问的部分，而不是依赖具体的实现细节。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><ol><li><strong>User Events</strong>：提供了模拟用户操作的方法，比如用户点击、输入等操作，以便测试组件在交互过程中的行为。</li><li><strong>FireEvent</strong>：用于触发各种事件，比如点击事件、输入事件等，以模拟用户与组件的交互。</li><li><strong>Act</strong>：用于包裹对组件的操作，确保其在测试过程中表现得像在真实环境中一样。</li><li><strong>WaitFor</strong>：提供了等待特定条件满足的方法，用于处理异步操作或动画效果。</li></ol><h4 id="_8-3-简单使用" tabindex="-1"><a class="header-anchor" href="#_8-3-简单使用"><span>8.3 简单使用</span></a></h4><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;sum&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;sums up two values&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ App todo 案例</p><p>​ <img src="/assets/Snipaste_2024-06-24_23-38-56-DqPVruBa.png" alt=""></p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">import React, { Component } from &#39;react&#39;</span>
<span class="line"></span>
<span class="line">export class App extends Component {</span>
<span class="line">    state = {</span>
<span class="line">        list: [&#39;111&#39;, &#39;222&#39;, &#39;333&#39;],</span>
<span class="line">        text: &#39;&#39;</span>
<span class="line">    }</span>
<span class="line">    render() {</span>
<span class="line">        return (</span>
<span class="line">            &lt;div&gt;</span>
<span class="line">                &lt;h2&gt;单元测试案例 todo&lt;/h2&gt;</span>
<span class="line">                &lt;div&gt;</span>
<span class="line">                    &lt;div&gt;</span>
<span class="line">                        &lt;input onChange={(val) =&gt; {</span>
<span class="line">                            this.setState({</span>
<span class="line">                                text: val.target.value</span>
<span class="line">                            })</span>
<span class="line">                        }} value={this.state.text}&gt;&lt;/input&gt;</span>
<span class="line">                        &lt;button onClick={() =&gt; {</span>
<span class="line">                            this.setState({</span>
<span class="line">                                list: [...this.state.list,this.state.text],</span>
<span class="line">                                text: &#39;&#39;</span>
<span class="line">                            })</span>
<span class="line">                        }}&gt;add&lt;/button&gt;</span>
<span class="line">                    &lt;/div&gt;</span>
<span class="line">                    &lt;div&gt;</span>
<span class="line">                        {/* 这里的 &lt;&gt; 和 &lt;/&gt; 实际上是 &lt;React.Fragment&gt; 的简写形式。它们的作用是告诉 React，这些元素是作为一个组合单元返回的，但不需要额外的父节点包裹 */}</span>
<span class="line">                        &lt;ul&gt;</span>
<span class="line">                            {</span>
<span class="line">                                this.state.list.map((item, index) =&gt; {</span>
<span class="line">                                    return (</span>
<span class="line">                                        &lt;li key={item}&gt;{item} &lt;button onClick={() =&gt; {</span>
<span class="line">                                            let newState = [ ...this.state.list ]</span>
<span class="line">                                            newState.splice(index, 1)</span>
<span class="line">                                            this.setState({</span>
<span class="line">                                                list: newState</span>
<span class="line">                                            })</span>
<span class="line">                                        }}&gt;del&lt;/button&gt; &lt;/li&gt;</span>
<span class="line">                                    )</span>
<span class="line">                                })</span>
<span class="line">                            }</span>
<span class="line">                        &lt;/ul&gt;</span>
<span class="line">                    &lt;/div&gt;</span>
<span class="line">                &lt;/div&gt;</span>
<span class="line">            &lt;/div&gt;</span>
<span class="line">        )</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ <strong>单元测试代码</strong></p><p>​ test --&gt; 01-react-test-render.test.js</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">import</span> ShallowRender <span class="token keyword">from</span> <span class="token string">&#39;react-test-renderer/shallow&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../App&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> act <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-dom/test-utils&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> screen<span class="token punctuation">,</span> fireEvent<span class="token punctuation">,</span> WaitFor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@testing-library/react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;react-test-render&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 测试节点</span></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;todo&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 虚拟DOM</span></span>
<span class="line">        <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShallowRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        render<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>render<span class="token punctuation">.</span><span class="token function">getRenderOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>render<span class="token punctuation">.</span><span class="token function">getRenderOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment">// expect 期望 == h2</span></span>
<span class="line">        <span class="token function">expect</span><span class="token punctuation">(</span>render<span class="token punctuation">.</span><span class="token function">getRenderOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// 测试功能</span></span>
<span class="line">    <span class="token comment">// it(&quot;删除功能&quot;, function(){</span></span>
<span class="line">    <span class="token comment">//     // 获取APP-DOM</span></span>
<span class="line">    <span class="token comment">//     // const app = act.renderIntoDocument(&lt;App/&gt;)</span></span>
<span class="line">    <span class="token comment">//     // 得到li节点（标签）多个</span></span>
<span class="line">    <span class="token comment">//     // ReactTestUtil.scryRendererDOMComponentsWithTag(app, &#39;li&#39;)</span></span>
<span class="line">    <span class="token comment">//     // 得到删除按钮 标签</span></span>
<span class="line">    <span class="token comment">//     // let deleButton = </span></span>
<span class="line">    <span class="token comment">//     // 模拟点击</span></span>
<span class="line">    <span class="token comment">//     // ReactTestUtil.Simulate.click()</span></span>
<span class="line">    <span class="token comment">//     // expect(todoitems.length - 1).toBe(todoitemsAfterClick.length)</span></span>
<span class="line">    <span class="token comment">//     // 获取APP-DOM</span></span>
<span class="line">    <span class="token comment">//     render(&lt;App /&gt;);</span></span>
<span class="line">    <span class="token comment">//     screen.debug()</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//     // 得到li节点（标签）多个</span></span>
<span class="line">    <span class="token comment">//     const todoitems = screen.getAllByRole(&#39;listitem&#39;)</span></span>
<span class="line">    <span class="token comment">//     // 得到删除按钮 标签</span></span>
<span class="line">    <span class="token comment">//     let deleButtons =  screen.getAllByRole(&#39;button&#39;, { name: &#39;del&#39;})</span></span>
<span class="line">    <span class="token comment">//     if (deleButtons.length &gt; 1) {</span></span>
<span class="line">    <span class="token comment">//         // 模拟点击第一个删除按钮</span></span>
<span class="line">    <span class="token comment">//         // deleButtons[0].click();</span></span>
<span class="line">    <span class="token comment">//          // 使用 act 包裹点击事件</span></span>
<span class="line">    <span class="token comment">//         act(() =&gt; {</span></span>
<span class="line">    <span class="token comment">//             fireEvent.click(deleButtons[0]);</span></span>
<span class="line">    <span class="token comment">//         });</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//         // 重新获取所有 li 元素</span></span>
<span class="line">    <span class="token comment">//         const updatedTodoItems = screen.getAllByRole(&#39;listitem&#39;);</span></span>
<span class="line">    <span class="token comment">//         console.log(deleButtons.length, updatedTodoItems.length )</span></span>
<span class="line">    <span class="token comment">//         expect(updatedTodoItems.length).toBe(todoitems.length - 1);</span></span>
<span class="line">    <span class="token comment">//     }</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//     console.log(todoitems.length)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// })</span></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;添加功能&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 获取APP-DOM</span></span>
<span class="line">        <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// screen.debug()</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 得到li节点（标签）多个</span></span>
<span class="line">        <span class="token keyword">const</span> todoitems <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getAllByRole</span><span class="token punctuation">(</span><span class="token string">&#39;listitem&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment">// 得到增加按钮 标签</span></span>
<span class="line">        <span class="token keyword">let</span> AddButtons <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">&#39;button&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;add&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;2222222222222222222&#39;</span><span class="token punctuation">,</span> AddButtons<span class="token punctuation">.</span>length<span class="token punctuation">)</span> </span>
<span class="line">        <span class="token comment">// if (AddButtons.length &gt; 0) {</span></span>
<span class="line">            <span class="token comment">// 使用 act 包裹点击事件</span></span>
<span class="line">            <span class="token comment">// 得到input节点并且输入值</span></span>
<span class="line">            <span class="token keyword">const</span> input <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">&#39;textbox&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            input<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;chuck1111111&#39;</span></span>
<span class="line">            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;222222222&#39;</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span> </span>
<span class="line">            fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>AddButtons<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// act(() =&gt; {</span></span>
<span class="line">                </span>
<span class="line">            <span class="token comment">// });</span></span>
<span class="line">            <span class="token comment">// 重新获取所有 li 元素</span></span>
<span class="line">            <span class="token keyword">const</span> updatedTodoItems <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getAllByRole</span><span class="token punctuation">(</span><span class="token string">&#39;listitem&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;11111111111&#39;</span><span class="token punctuation">,</span> updatedTodoItems<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token function">expect</span><span class="token punctuation">(</span>updatedTodoItems<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>todoitems<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// }</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// 普通测试</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;sum&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;sums up two values&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-redux-soga" tabindex="-1"><a class="header-anchor" href="#_9-redux-soga"><span>9 redux-soga</span></a></h3></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1749967714@qq.com">codePiece</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BzeNYtxQ.js" defer></script>
  </body>
</html>
